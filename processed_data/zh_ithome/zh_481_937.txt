麻 AI 难 微软 宣布 公开麻 AI   Suphx   十 段 秘籍 日前 微软 亚洲 研究院 arXiv 平台 上 正式 发表 麻 AI 系统 Suphx 论文 公布 Suphx 背后 包括 决策 流程 模型 架构 训练 算法 核心 技术 细节 麻 AI   到底 难点 Suphx 游戏 AI 领域 具有 跨越性 突破 具体 实现 近日 微软 亚洲 研究院 Suphx 研发 团队 arXiv 平台 上 正式 发表 论文 公布 Suphx 背后 核心 技术 麻 AI 面临 挑战 麻 AI 系统 Suphx 主要 基于 深度 强化 学习 技术 深度 强化 学习 系列 游戏 AI 中 取得 巨大 成功 想 直接 应用 麻 AI 上 殊为 不易 面临 若干 挑战 挑战 麻将 计分 规则 通常 都 非常 复杂 天凤平台 竞技 麻将 中 计分 规则 更加 复杂 轮 麻 游戏 通常 8 局 更 局 结束 后 四 位 玩家 都 会 局 得分 （ 可能 正 可能 负 ） 一整轮 游戏 都 结束 后 四 位 玩家 所有局 累计 得分 排名 计算 轮 游戏 点数 奖励 天凤 平台 上 排 一二 名 玩家 会 得到 一定 数目 点数 排 第三 位 玩家 点数 不 变 排 第四 位 玩家 会 扣 去 一定 数目 点数   玩家 点数 段位 都 可能 会 起起 落落 点数 增加 一定 程度 时 段位 上升 点数 扣 0时 会 降段 提高 段位 玩家 需要 尽量 排 第一 位 第二 位 尽量 避免 排 第四 位 有趣 轮 游戏 最终 点数 多局 累计 得分 决定 高手 可能 会 策略性 输掉 一些 局 也就是说 局 输赢 不 直接 代表 玩家 好 不 好 不 直接 使用 每局 得分 强化 学习 奖励 反馈 信号 微软 亚洲 研究院 研究员 找到 种 方法 会 后文 中 解释 天凤 平台 上 局 游戏 计分 规则 都 需要 赢家 手里 牌型 累计 计算 得分 牌型 非常 可能 清一色 混 一色 门清 不同 牌型 得分 会 相差 很 大 计分 规则 象棋 围棋 游戏 复杂 麻 高手 需要 谨慎 选择 牌型 胡牌 概率 胡牌 得分 上 进行 平衡 取得 第一 二 位 摆脱 第四 位 挑战 二 博弈论 角度 看 麻 多人 非 完美 信息 博弈 麻 一共 136 张 牌 位 玩家 只能 看到 很 少 牌 包括 13 张 手牌 所有 人 出来 牌 更 牌 看不到 包括 三 位 玩家 手牌 墙牌 面对 隐藏 未知 信息 麻 玩家 很 难 仅 手牌 做出 一个 很 好 决策 挑战 三 麻 计分 规则 复杂 之外 打法 比较 复杂 需要 考虑 多种 决策 类型 正常 摸牌 打牌 之外 还要 经常 决定 是否 吃 牌 碰牌 杠牌 立直 是否 胡牌 任意 位 玩家 吃碰杠 胡牌 都 会 改变 摸牌 顺序 研究员 很 难 麻 构建 棵 规则 博弈树 （ game   tree ） 去 构建 棵 博弈树 棵 博弈树 会 非常 庞大 不计其数 分支 导致 以前 一些 很 好 方法 蒙特卡洛树 搜索 ( MCTS ) 蒙特卡洛 反 事实 遗憾 最 小化 ( MCCFR ) 算法 都 无法 直接 应用 Suphx 决策 流程 模型 架构 Suphx 打牌 策略 包含 5 需要 训练 模型 应 麻 复杂 决策 类型 —— 丢牌 模型 立直 模型 吃牌 模型 碰牌 模型 杠牌 模型 5 模型 都 基于 深度 残差 卷积 神经 网络 Suphx 一个 基于 规则 赢牌 模型 决定 赢牌 不要 赢 牌 图 1 Suphx 决策 流程 模型 输入 包含 两 大 类 信息 1.      当前 观测 信息 玩家 手牌 公开牌 （ 包括 丢 出来 牌 碰 牌 明杠 牌 ） 每个 玩家 累计 得分 座位 段位 2.      将来 进行 预测 信息 打某 张牌 还 需要 张 牌 才 胡牌 能够 赢 分 胡牌 概率 大 Suphx 训练 算法 Suphx 训练 过程 分为 三 主要 步骤 使用 来自 天凤 平台 高手 打牌 记录 监督 学习 训练 5 模型 使用 自我 博弈 强化 学习 微软 亚洲 研究院 Suphx 研发 团队 设计 两 技术 解决 麻 本身 独特性 带来 挑战 最后 实战 时 采用 线 策略 适应 算法 进一步 提高 Suphx 能力 分布式 强化 学习 Suphx 整个 训练 过程 十分 复杂 需要 GPU CPU 协同 Suphx 研发 团队 采用 分布式 架构 （ 图 2 示 ） 架构 包括 一个 参数 服务器 自我 博弈 节点 每个 节点 里 包含 麻将 模拟器 推理 引擎 进行 策略 之间 博弈 （ 打麻 ） 每个 自我 博弈 节点 定期 打牌 记录 发送 参数 服务器 参数 服务器 会 利用 打牌 记录 训练 提高 当前 策略 段 时间 自我 博弈 节点 会 参数 服务器 回 最新 策略 用来 进行 下 阶段 自我 博弈 图 2 分布式 训练 全局 奖励 预测 麻将 计分 规则 很 复杂 —— 玩家 每局 得分 轮 游戏 多局 累计 分数 排名 计算 点数 麻 AI 知道 好 不 好 每局 得分 轮 游戏 最终 点数 都 不 适合 用来 做 强化 学习 训练 反馈 信号 最终 奖励 点数 反馈 信号 不 区分 好 局 差 局 研究员 需要 每局 都 单独 提供 强化 学习 训练 信号 单独 计算 每局 分数 未必 反映 出 局 好坏 顶级 玩家 会 策略性 输牌 轮 游戏 最后 一两 局 中 累计 得分 排位 第一 选手 累计 分数 领先 大 情况 下 会 有意识 排位 第三 第四 选手 赢下 局 不 排 第二 位 玩家 赢 稳稳 保住 总 排位 第一 也就是说 局 得分 负 不 一定 意味着 策略 不 好 强化 学习 训练 提供 有效 信号 需要 最终 游戏 奖励 适当 归因 轮 游戏 中 Suphx 研发 团队 引入 一个 全局 奖励 预测器 基于 本局 信息 之前 所有局 信息 预测 出 最终 游戏 奖励 Suphx 中 奖励 预测器 一个 递归 神经 网络   ( GRU ) 训练 数据 来自 高手 玩家 天凤 平台 历史 记录 预测器 训练 好 后 自我 博弈 生成 游戏 Suphx 研发 团队 前局 预测 最终 奖励 上 局 预测 最终 奖励 之间 差值 该局 强化 学习 训练 反馈 信号 先 知 教练 麻 中 存在 丰富 隐藏 信息 玩家 手牌 墙牌 不 获得 隐藏 信息 很 难 确保 动作 （ 丢 三万 ） 好坏 麻 很 难 一个 根本 原因 这种 情况 下 Suphx 强化 学习 提高 策略 学习 速度 会 非常 慢 加快 强化 学习 训练 速度 Suphx 研发 团队 引入 一个 先知 看到 所有 信息 包括 ( 1 ) 玩家 私有 手牌 ( 2 ) 所有 玩家 公开牌 ( 3 ) 公共 信息   ( 4 ) 三 玩家 私有 手牌 ( 5 ) 墙牌 ( 1 ) ( 2 ) ( 3 ) 正常 玩家 获得 ( 4 ) ( 5 ) 先知 才 获得 额外 " 完美 " 信息 图 3 左边 正常 观测 信息 右边 完全 信息 （ 包括 手手牌 墙牌 完美 信息 ） 不 公平 完美 信息 先知 强化 学习 训练 后 很 容易 成为 麻 超级 高手 安定 段位 很 容易 超过 20 段 利用 先知 引导 加速 AI 训练 实验 表明 简单 知识 萃取 （ knowledge   distillation ） 模仿 学习 （ imitation   learning ） 不 很 好 先知 超能力 转移 AI 系统 上 —— 一个 只能 获取 有限 信息 正常 AI 来说 很 难 模仿 一个 训练有素 先知 行为 先知 能力 太 强 普通 AI 无法 理解 先知 看到 玩家 手牌 知道 每个 玩家 胡 牌 出 绝对 安全 牌 避免 点炮 正常 AI 没有 信息 可能 完全 不 理解 先知 会 张 牌 不 学 这种 行为 研究 人员 需要 一个 更 聪明 方法 先知 引导 正常 AI 训练 Suphx 中 Suphx 研发 团队 使用 包括 完美 信息 在内 所有 特征 先知 进行 强化 学习 训练 步 中 控制 先知 学习 进度 不 过于 强大 完美 特征 增加 mask 逐渐 使 先知 最终 过渡 正常 AI 继续 训练 正常 AI 进行 一定 数量 迭代 采用 衰减 学习率 拒绝 采样 技巧 调整 训练 过程 AI 技术 不断 精进 参数化 蒙特卡洛 策略 适应 一个 麻 高手 来说 初始 手牌 不 打牌 策略 会 很 大 不同 初始 手牌 好 会 积极 进攻 获得 更 得分 初始 手牌 不 好 会 倾向 防守 放弃 胡牌 减少 损失 此前 围棋 AI 星际 争霸 游戏 AI 很 大 不同 能够 对战 过程 中 线下 训练 策略 进行 调整 得到 更 强 麻 AI 蒙特卡洛树 搜索 ( MCTS ) 围棋 游戏 AI 中 种 成熟 技术 提高 战时 胜率 遗憾 如前所述 麻将 摸牌 打牌 顺序 不 固定 很 难 建立 一个 规则 博弈树 MCTS 不 直接 应用 麻 AI Suphx 中 Suphx 研发 团队 设计 种 新 方法 命名 参数 蒙特卡洛 策略 适应 （ pMCPA ） 当初始 手牌 发 麻 AI 手中 时 模拟 调整 离线 训练 好 策略 使 更 适应 给定 初始 手牌 微软 亚洲 研究院 实验 表明 相对 麻 隐藏 信息集 平均 大小 10 48+ 次方 倍 模拟 次数 不 需要 很 大 pMCPA 不 需要 局 手牌 收集 所有 可能 后续 状态 统计 数据 pMCPA 种 参数化 方法 微调 更新 后 策略 帮助 研究 团队 有限 模拟 中 获得 知识 推 广泛化 未 见 状态 天凤 平台 线 实战 经历 训练 后 Suphx 出道 Suphx 已 天凤 平台特 上房 玩家 战 5000 场 达到 房间 目前 最高 段位 10 段 安定 段位 达到 8.7 段 （ 图 4 示 ） 超过 平台 上 两 知名 AI 顶级 人类 选手 平均 水平 图 4 天凤 平台 特 上房 安定 段位 实战 中 Suphx 非常 擅长 防守 4 位 率 点炮率 （ deal - in   rate ） 都 尤其 低 （ 图 5 ） Suphx 牌风 比较 鲜明 另辟蹊径 创造 许多 新 策略 打法 特别 擅长 保留 安全牌 倾向 胡混 一色 图 6 展示 Suphx 天凤 平台 实战 时 保留 安全牌 一个 例子 当前 时刻 Suphx （ 南家 ） 需要 丢牌 人类 玩家 通常 会 丢 北风 Suphx 丢掉 张 7 条 人类 玩家 看 起来 会 觉得 很 不 寻常 7 条 张 好牌 丢掉 7 条 会 胡牌 进度 变 慢 Suphx 丢掉 7 条 留住 北风 北风 张 安全牌 未来 时刻 有人 突然 立直 胡牌 Suphx 出 北风 不 点炮 后面 机会 胡牌 前面 已经 北风 丢掉 出 张 安全牌 不得不 拆掉 手里 好牌 大大 降低 胡牌 可能 图 5 Suphx 对战 中 一些 统计 数据 包括 1/2/3/4 位 率 胡牌率 点炮率 （ 注 上 表格 中 Bakuuchi 东京大学 /HEROZ 研发 麻 AI 爆打 ） 图 6 Suphx （ 南边 位置 ） 保留 安全牌 北风 许多 观看   Suphx 比赛 玩家 表示 观战 过程 中 受到 启发 麻 爱好者 Suphx 称作 麻 教科书 Suphx 老师 学习 Suphx 打法 提升 丰富 麻将 技巧 已经 看 300 场   Suphx 比赛 不 再 观看 人类 玩家 比赛 Suphx 身上 学 很多 新 技术 三 人 麻 打法 有着 非常 大 启发 麻 选手 太 く な い お 社交 媒体 上 说 第一 位 四 人 麻将 三 人 麻 中 均 取得 天凤位 顶级 玩家 介绍 Suphx 天凤 平台 上 取得 成绩 一个 未来 微软 亚洲 研究院 Suphx 引入 更 新 技术 继续 推动 麻 AI 不 完美 信息 游戏 研究 前沿